<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.1/dist/web3.min.js" integrity="sha256-cdcyjItaOZqsMpqD2GtRBYwB4OBBT8RXfav8ecUYxtg=" crossorigin="anonymous"></script>


  <script type="text/javascript">

    
    //api key to etherscan
    var apikey = 'X4Q94Q3ECUW2726542QEAFADQ11GZF8TB5';

    /*
    @ ajax call for retriving balance
    */
    var ajax = function(u, f, m, a){
    var x = false;
    try{
      x = new ActiveXObject('Msxml2.XMLHTTP')
    } catch(e) {
      try {
        x = new ActiveXObject('Microsoft.XMLHTTP')
      } catch(e) {
        x = new XMLHttpRequest()
      }
    }

    if(x==false) {
      return false;
    }

    x.open(m, u, true);
    x.onreadystatechange=function(){
      if((x.readyState==4) && f)
        f(x.responseText);
    };

    if(m == 'POST'){
      x.setRequestHeader('Content-type','application/x-www-form-urlencoded');
    }

    x.send(a);
  }

  


    var privateKey = "69327b77f67b18b903fda6975fa2ee9f6fcfc5dda443d8d5b53d1301560303d4";


    //var ethNetwork = 'https://api-goerli.etherscan.io';
    //var web3 = new Web3(new Web3.providers.HttpProvider(ethNetwork));
    //var web3 = new Web3(ethNetwork);
    var georliInfura = "https://goerli.infura.io/v3/822bca8c69214439a69e0ad17cd4117a"
    var web3 = new Web3(georliInfura);


    console.log('web3: ', web3);
    //generate address form privkey
    var accountInfo = web3.eth.accounts.privateKeyToAccount(privateKey);
    //web3.eth.getAccounts(console.log);
    
    console.log('accountInfo: ', accountInfo);
    console.log('myAddress: ', accountInfo.address);  //should generate "0x17b8646e20F444ecDD5cef1f1fDC5F95c30f1946"

    //get balance
    var ETHBalance = 0;
    ajax('https://api-goerli.etherscan.io/api?module=account&action=balance&address='+accountInfo.address+'&tag=latest&apikey='+apikey, function(data) {
      console.log('getBalance: ', data);
      var r = JSON.parse(data);

      console.log('r: ', r);
      if (r.status = '1' ) {
        ETHBalance = web3.utils.fromWei(r.result, 'ether');
        console.log('your ETH balance is:'+ ETHBalance);
        
      }
    }, "GET");



    var destinationAddress = "0x7aFac68875d2841dc16F1730Fba43974060b907A";
    //const amountToSend = web3.utils.toWei('1'); // Convert 1 ether to wei



async function signTx(privkey) {


  var transaction = {
  from: accountInfo.address,
  to: '0x7aFac68875d2841dc16F1730Fba43974060b907A',
  value: web3.utils.toWei('1', 'gwei'),
  data: '',
  gas: 30000,
  baseChain: 'goerli',
  };

  //var signedTx = await web3.eth.accounts.signTransaction(transaction, privkey);
  var signedTx = web3.eth.accounts.signTransaction(transaction, privateKey).then(console.log);

  
  web3.eth.sendSignedTransaction(signedTx.rawTransaction, function(error, hash) {
        if (!error) {
          console.log("üéâ The hash of your transaction is: ", hash, "\n Check Alchemy's Mempool to view the status of your transaction!");
          console.log('txHash: '+ signedTx.transactionHash);
        } else {
          console.log("‚ùóSomething went wrong while submitting your transaction:", error)
        }
       });

       

  
}


    async function signAndSend(tx_i, privkey) {
      
      try{
        var signedTx = await web3.eth.accounts.signTransaction(tx_i, privkey);
        console.log('signedTransaction: ', signedTx);
      } catch(e){
          console.log('catch: ', JSON.stringify(e, null, 3), e)
      }
    

      try{
        var signedTx = await web3.eth.accounts.signTransaction(tx_i, privkey);
        console.log('signedTransaction: ', signedTx);
      } catch(e){
          console.log(JSON.stringify(e, null, 3),)
      }

    }


    //sign and send transaction
    //signAndSend(tx_inputs, privateKey);
    signTx(privateKey);
 
  </script>
  
</head>
<body>

</body>
</html>